<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Categorization Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 30px;
            padding: 20px;
            border-radius: 5px;
            display: none;
        }
        .result.success {
            background: #e8f5e9;
            border: 1px solid #4CAF50;
            display: block;
        }
        .result.error {
            background: #ffebee;
            border: 1px solid #f44336;
            display: block;
        }
        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 600;
            margin: 5px 5px 5px 0;
        }
        .badge.urgent { background: #f44336; color: white; }
        .badge.high { background: #ff9800; color: white; }
        .badge.medium { background: #2196F3; color: white; }
        .badge.low { background: #9E9E9E; color: white; }
        .badge.complaint { background: #e91e63; color: white; }
        .badge.question { background: #9c27b0; color: white; }
        .badge.request { background: #3f51b5; color: white; }
        .badge.feedback { background: #4caf50; color: white; }
        .badge.tag { background: #607d8b; color: white; }
        .samples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .sample {
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .sample:hover {
            border-color: #4CAF50;
            background: #f0f0f0;
        }
        .sample h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .sample p {
            margin: 0;
            font-size: 13px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ AI Categorization Test</h1>
        
        <div class="input-group">
            <label>Subject</label>
            <input type="text" id="subject" placeholder="Enter query subject...">
        </div>
        
        <div class="input-group">
            <label>Message Content</label>
            <textarea id="content" placeholder="Enter query content..."></textarea>
        </div>
        
        <div>
            <button onclick="testCategorization()">üöÄ Test Categorization</button>
            <button onclick="clearForm()">üóëÔ∏è Clear</button>
        </div>
        
        <div id="result" class="result"></div>
        
        <h3 style="margin-top: 40px;">Sample Queries (click to test)</h3>
        <div class="samples">
            <div class="sample" onclick="loadSample(0)">
                <h4>üî¥ Critical Issue</h4>
                <p>System down, losing business money</p>
            </div>
            <div class="sample" onclick="loadSample(1)">
                <h4>üò§ Customer Complaint</h4>
                <p>Service not working for days, no response</p>
            </div>
            <div class="sample" onclick="loadSample(2)">
                <h4>‚ùì General Question</h4>
                <p>How to use a specific feature</p>
            </div>
            <div class="sample" onclick="loadSample(3)">
                <h4>üí° Feature Request</h4>
                <p>Asking for new functionality</p>
            </div>
            <div class="sample" onclick="loadSample(4)">
                <h4>üòä Positive Feedback</h4>
                <p>Happy customer, loving the product</p>
            </div>
            <div class="sample" onclick="loadSample(5)">
                <h4>üêõ Bug Report</h4>
                <p>Technical error with details</p>
            </div>
        </div>
    </div>
    
    <script>
        const samples = [
            {
                subject: "URGENT: Production system is completely down!",
                content: "Our entire production environment has been down for 2 hours. All our customers are affected and we're losing thousands of dollars per minute. We need someone to fix this IMMEDIATELY!"
            },
            {
                subject: "Terrible service - no response for 4 days",
                content: "I've been trying to get help for 4 days now and haven't received a single response. This is completely unacceptable. Your support is the worst I've ever experienced. I want a refund immediately!"
            },
            {
                subject: "How do I export my data?",
                content: "I need to export all my customer data to CSV format for analysis in Excel. Can you guide me through the process? Also, is there a way to schedule automatic exports?"
            },
            {
                subject: "Feature request: Dark mode",
                content: "Would love to see dark mode added to the interface. Working at night is painful with the bright white background. Many users in the community have been asking for this feature too."
            },
            {
                subject: "Loving the new update!",
                content: "Just wanted to say the latest update is fantastic! The performance improvements are noticeable and the new dashboard design is much cleaner. Great job to the team!"
            },
            {
                subject: "Error when logging in",
                content: "I'm getting a 500 Internal Server Error whenever I try to log in with my credentials. The error message says 'Database connection failed'. This started happening after the maintenance yesterday."
            }
        ];
        
        function loadSample(index) {
            const sample = samples[index];
            document.getElementById('subject').value = sample.subject;
            document.getElementById('content').value = sample.content;
        }
        
        function clearForm() {
            document.getElementById('subject').value = '';
            document.getElementById('content').value = '';
            document.getElementById('result').style.display = 'none';
        }
        
        async function testCategorization() {
            const subject = document.getElementById('subject').value;
            const content = document.getElementById('content').value;
            const resultDiv = document.getElementById('result');
            
            if (!subject || !content) {
                alert('Please enter both subject and content');
                return;
            }
            
            resultDiv.innerHTML = '<p>ü§ñ Processing with AI...</p>';
            resultDiv.className = 'result success';
            
            try {
                const response = await fetch('http://localhost:8000/api/webhooks/generic', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        channel: 'email',
                        sender_email: 'test@example.com',
                        sender_name: 'Test User',
                        subject: subject,
                        content: content
                    })
                });
                
                if (!response.ok) {
                    throw new Error('API request failed');
                }
                
                const query = await response.json();
                
                // Wait a bit for background categorization
                setTimeout(async () => {
                    const detailResponse = await fetch(`http://localhost:8000/api/queries/${query.id}`);
                    const detailedQuery = await detailResponse.json();
                    
                    resultDiv.innerHTML = `
                        <h3>‚úÖ Query Created & Categorized</h3>
                        <p><strong>Query ID:</strong> #${detailedQuery.id}</p>
                        <p>
                            <span class="badge ${detailedQuery.category}">${detailedQuery.category.toUpperCase()}</span>
                            <span class="badge ${detailedQuery.priority}">${detailedQuery.priority.toUpperCase()}</span>
                        </p>
                        ${detailedQuery.tags.length > 0 ? `
                            <p><strong>Tags:</strong><br>
                            ${detailedQuery.tags.map(tag => `<span class="badge tag">${tag}</span>`).join('')}
                            </p>
                        ` : ''}
                        <p><strong>Status:</strong> ${detailedQuery.status}</p>
                        <p style="margin-top: 15px; font-size: 13px; color: #666;">
                            Created at: ${new Date(detailedQuery.received_at).toLocaleString()}
                        </p>
                    `;
                }, 2000); // Wait 2 seconds for background task
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<p>‚ùå Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
